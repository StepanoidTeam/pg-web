(this["webpackJsonppg-web"]=this["webpackJsonppg-web"]||[]).push([[0],{30:function(e,t,n){e.exports=n(48)},41:function(e,t,n){},42:function(e){e.exports=JSON.parse('{"name":"pg-web","homepage":"https://stepanoidteam.github.io/pg-web","version":"0.1.5","private":true,"scripts":{"start":"PORT=3001 react-scripts start","deploy":"gh-pages -d build -m deployment","predeploy":"npm version patch -f && npm run build","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject"},"dependencies":{"@testing-library/jest-dom":"^4.2.4","@testing-library/react":"^9.4.0","@testing-library/user-event":"^7.2.1","classnames":"^2.2.6","react":"^16.12.0","react-dom":"^16.12.0","react-router-dom":"^5.1.2","react-scripts":"3.3.0","source-map-explorer":"^2.2.2","use-global-hook":"^0.1.12"},"eslintConfig":{"extends":"react-app","rules":{"no-empty-pattern":"off","react-hooks/exhaustive-deps":"off"}},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"devDependencies":{"gh-pages":"^2.2.0"}}')},43:function(e,t,n){},44:function(e,t,n){},45:function(e,t,n){},46:function(e,t,n){},47:function(e,t,n){},48:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(23),c=n.n(o),s=n(10),l=n(1),i=n(3),u=n(9),m=n(14),p=n.n(m),f=n(15),d=n(18),h=n(24),b=n(11),g=n(12),E=function(){function e(){Object(b.a)(this,e)}return Object(g.a)(e,null,[{key:"set",value:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=new Date(Date.now()+a*e.msDay);document.cookie="".concat(t,"=").concat(n,";expires=").concat(r.toUTCString(),";path=/")}},{key:"get",value:function(e){var t=document.cookie.split("; ").map((function(e){return e.split("=")})).find((function(t){var n=Object(l.a)(t,2),a=n[0];n[1];return a===e}))||[null,null];return Object(l.a)(t,2)[1]}},{key:"delete",value:function(e){var t=new Date(0);document.cookie="".concat(e,"=;expires=").concat(t.toUTCString(),";path=/")}},{key:"clear",value:function(){document.cookie.split("; ").map((function(e){return e.split("=")})).forEach((function(t){var n=Object(l.a)(t,1)[0];return e.delete(n)}))}}]),e}();E.msDay=864e5;var v={isOnline:!1,apiVersion:null,authToken:E.get("authToken"),isAuthenticated:!1,user:null,counter:0,rooms:[],game:{GameRoomId:null,playerBoards:[]}},w={setOnline:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.setState({isOnline:t})},setApiVersion:function(e,t){e.setState({apiVersion:t})},addToCounter:function(e,t){e.setState({counter:e.state.counter+1})},setUserData:function(e,t){var n=t.AuthToken,a=t.Id,r=t.Name,o=t.GameRoomId;e.setState({authToken:n,user:{id:a,name:r},isAuthenticated:!0,game:Object(d.a)({},e.state.game,{GameRoomId:o})}),E.set("authToken",n)},clearUserData:function(e){e.setState({authToken:null,user:null,isAuthenticated:!1}),E.delete("authToken")},setRooms:function(e,t){e.setState({rooms:t})},setPlayerBoards:function(e,t){e.setState({game:Object(d.a)({},e.state.game,{playerBoards:t})})}},j=Object(h.a)(r.a,v,w);function x(e){var t=e.children,n=Object(f.a)(e,["children"]),a=j(),o=Object(l.a)(a,1)[0].isAuthenticated;return r.a.createElement(u.b,Object.assign({},n,{render:function(e){var n=e.location;return o?t:r.a.createElement(u.a,{to:{pathname:"/login",state:{from:n}}})}}))}var O=n(6),N=n.n(O),y="https://pg-api.azurewebsites.net/api";function k(e){var t,n,a,r,o,c=arguments;return N.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:for(s.prev=0,t=c.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=c[a];return s.next=4,N.a.awrap(fetch.apply(void 0,["".concat(y,"/").concat(e)].concat(n)));case 4:if((r=s.sent).ok){s.next=9;break}return s.next=8,N.a.awrap(r.json());case 8:throw s.sent;case 9:return s.next=11,N.a.awrap(r.json());case 11:return o=s.sent,s.abrupt("return",o.data);case 15:return s.prev=15,s.t0=s.catch(0),console.warn("api error",s.t0),s.abrupt("return",Promise.reject(s.t0));case 19:case"end":return s.stop()}}),null,null,[[0,15]])}n(41);var T=n(42).version;function C(){var e=j(),t=Object(l.a)(e,2),n=t[0].apiVersion,o=t[1],c=o.setApiVersion,s=o.setOnline;return Object(a.useEffect)((function(){N.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",k("version").then((function(e){return e.version})));case 1:case"end":return e.stop()}})).then((function(e){c(e),s(!0)}))}),[]),r.a.createElement("div",{className:"version-holder flex-column m-1"},r.a.createElement("span",null,"web: ",T),r.a.createElement("span",null,"api: ",n))}var S=n(28),I=n(27),A=n(29),U=(n(43),function(e){function t(e){var n;return Object(b.a)(this,t),(n=Object(S.a)(this,Object(I.a)(t).call(this,e))).state={isFocused:!1},n}return Object(A.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.label,a=t.value,o=t.helperText,c=t.icon,s=t.errorText,l=t.onChange,i=this.state.isFocused,u=0===a.length,m=!!s;return r.a.createElement("label",{className:p()("input cursor-pointer",{"is-focused":i,"is-empty":u,"has-error":m})},r.a.createElement("div",{className:"input-body flex-row justify-between"},r.a.createElement("div",{className:"flex-column justify-center position-relative w-100 px-2"},r.a.createElement("div",{className:"input-label"},n),r.a.createElement("input",{className:"input-value w-100",type:"text",value:a,onChange:function(e){return l(e.target.value)},onFocus:function(){return e.setState({isFocused:!0})},onBlur:function(){return e.setState({isFocused:!1})}})),c&&!m&&r.a.createElement("i",{className:"input-icon material-icons flex-row align-center mx-2"},c),m&&r.a.createElement("i",{className:"error-icon material-icons flex-row align-center mx-2"},"error")),r.a.createElement("hr",{className:"m-0"}),r.a.createElement("div",{className:"input-footer flex-row ml-2"},o&&!m&&r.a.createElement("span",{className:"helper-text text-ellipsis",title:o},o),m&&r.a.createElement("span",{className:"error-text text-ellipsis",title:s},s)))}}]),t}(r.a.Component));function D(){var e=j(),t=Object(l.a)(e,2);Object(s.a)(t[0]);var n=t[1].setUserData,o=Object(a.useState)("kekster2000"),c=Object(l.a)(o,2),m=c[0],p=c[1],f=Object(a.useState)("qwerty123"),d=Object(l.a)(f,2),h=d[0],b=d[1],g=Object(a.useState)(null),E=Object(l.a)(g,2),v=E[0],w=E[1],x=Object(u.g)(),O=(Object(u.h)().state||{from:{pathname:"/"}}).from;return r.a.createElement("div",{className:"form flex-column"},r.a.createElement(U,{label:"username",value:m,helperText:"username should be strong enough",errorText:v,icon:"face",onChange:function(e){return p(e)}}),r.a.createElement(U,{label:"password",value:h,helperText:"keep password simple",icon:"lock",onChange:function(e){return b(e)}}),r.a.createElement("button",{className:"button flex-row align-center justify-center",onClick:function(){(function(e){var t=e.username,n=e.password;return k("auth/login",{headers:{"Content-type":"application/json"},method:"POST",body:JSON.stringify({username:t,password:n})})})({username:m,password:h}).then((function(e){n(e),console.log("login ok",e),x.replace(O)})).catch((function(e){console.warn("login failed",e),w(e.message)}))}},r.a.createElement("span",null,"log in"),r.a.createElement("i",{className:"material-icons"},"arrow_forward")),r.a.createElement("span",{className:"p-2 flex-row justify-between"},"Don't have an account?",r.a.createElement(i.b,{to:"/register"},"register")))}function P(){var e=j(),t=Object(l.a)(e,2);Object(s.a)(t[0]);var n=t[1].setUserData,o=Object(a.useState)("jailbot007"),c=Object(l.a)(o,2),m=c[0],p=c[1],f=Object(a.useState)("kek123"),d=Object(l.a)(f,2),h=d[0],b=d[1],g=Object(a.useState)(null),E=Object(l.a)(g,2),v=E[0],w=E[1],x=Object(u.g)(),O=(Object(u.h)().state||{from:{pathname:"/"}}).from;return r.a.createElement("div",{className:"form flex-column"},r.a.createElement(U,{label:"username",value:m,helperText:"username should be strong enough",errorText:v,icon:"face",onChange:function(e){return p(e)}}),r.a.createElement(U,{label:"password",value:h,helperText:"keep password simple",icon:"lock",onChange:function(e){return b(e)}}),r.a.createElement("button",{className:"button flex-row align-center justify-center",onClick:function(){(function(e){var t=e.username,n=e.password;return k("auth/register",{headers:{"Content-type":"application/json"},method:"POST",body:JSON.stringify({username:t,password:n})})})({username:m,password:h}).then((function(e){n(e),console.log("register ok:",e),x.replace(O)})).catch((function(e){console.warn("register failed:",e.message),w(e.message)}))}},r.a.createElement("span",null,"register"),r.a.createElement("i",{className:"material-icons"},"add_box")),r.a.createElement("span",{className:"p-2 flex-row justify-between"},"Already have an account?",r.a.createElement(i.b,{to:"/login"},"log in")))}n(44);function R(){var e=Object(u.g)(),t=j(),n=Object(l.a)(t,2),o=n[0],c=o.authToken,s=o.isAuthenticated,i=o.user,m=n[1],p=m.setUserData,f=m.clearUserData;return Object(a.useEffect)((function(){c&&!s&&function(e){return k("auth/status",{headers:{"Content-type":"application/json",authToken:e},method:"POST",body:JSON.stringify({gameRoomId:!0,lastActivityTime:!0,isOnline:!0,authToken:!0,id:!0,name:!0})}).then((function(e){return e.data}))}(c).then((function(t){p(t),t.GameRoomId&&e.push("rooms/".concat(encodeURIComponent(t.GameRoomId)))})).catch(f)}),[]),r.a.createElement("div",{className:"status flex-column align-end p-1"},s?r.a.createElement("div",{className:"flex-row align-center"},r.a.createElement("div",{className:"flex-row align-center mx-2"},r.a.createElement("i",{className:"material-icons px-1"},"face"),r.a.createElement("span",null,i.name)),r.a.createElement("button",{className:"button flex-row align-center px-3",onClick:f},r.a.createElement("span",null," log out"),r.a.createElement("i",{className:"material-icons"},"exit_to_app"))):r.a.createElement("div",null,"unauthorized"))}function J(e){var t=e.children,n=Object(f.a)(e,["children"]),a=j(),o=Object(l.a)(a,1)[0].isAuthenticated;return r.a.createElement(u.b,Object.assign({},n,{render:function(){return o?r.a.createElement(u.a,{to:"/"}):t}}))}n(45);function _(){var e=Object(u.g)(),t=j(),n=Object(l.a)(t,2),o=n[0],c=o.authToken,s=o.rooms,i=n[1].setRooms,m=function(t){(function(e,t){return k("room/join",{headers:{"Content-type":"application/json",authToken:e},method:"POST",body:JSON.stringify({roomId:t})})})(c,t).then((function(n){e.push("/rooms/".concat(encodeURIComponent(t)))}))};return Object(a.useEffect)((function(){(function(e){return k("room/list",{headers:{"Content-type":"application/json",authToken:e},method:"GET"})})(c).then((function(e){i(e)}))}),[]),r.a.createElement("div",{className:"rooms form flex-column p-2"},r.a.createElement("h1",{className:"m-2"},"rooms"),r.a.createElement("ul",{className:"room-list list flex-column p-1 m-2"},s.map((function(e){return r.a.createElement("li",{className:"list-item flex-row align-center p-2 m-1",key:e.Id},r.a.createElement("span",{className:"room-name fill-left"},e.Name),r.a.createElement("div",{className:"flex-row align-center"},r.a.createElement("i",{className:"material-icons"},"group"),r.a.createElement("span",{className:"px-1"},e.UserCount),r.a.createElement("button",{className:"button",onClick:function(){return m(e.Id)}},"join")))}))),r.a.createElement("button",{className:"button flex-row align-center justify-center m-2",onClick:function(){e.push("/rooms/new")}},r.a.createElement("span",null,"create new room"),r.a.createElement("i",{className:"material-icons"},"add_box")))}function B(){var e=Object(u.i)()._roomId,t=Object(u.g)(),n=decodeURIComponent(e),o=j(),c=Object(l.a)(o,2),s=c[0],i=s.authToken,m=s.rooms,p=s.game,f=c[1].setPlayerBoards,d=p.playerBoards;Object(a.useEffect)((function(){(function(e){return k("game/status",{headers:{"Content-type":"application/json",authToken:e},method:"GET"})})(i).then((function(e){f(e.PlayerBoards)}))}),[]);var h=m.find((function(e){return e.Id===n}));if(!h)return null;var b=function(e){(function(e,t){return k("game/changeColor",{headers:{"Content-type":"application/json",authToken:e},method:"POST",body:JSON.stringify({userId:t})})})(i,e).then((function(){}))},g=function(e){(function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return k("game/toggleReady",{headers:{"Content-type":"application/json",authToken:e},method:"POST",body:JSON.stringify({state:t})})})(i,!0).then((function(){}))};return r.a.createElement("div",{className:"form flex-column p-2"},r.a.createElement("h1",{className:"flex-row m-2"},r.a.createElement("span",{className:"fill-left"},h.Name),r.a.createElement("div",{className:"flex-row align-center"},r.a.createElement("i",{className:"material-icons"},"group"),r.a.createElement("span",{className:"px-1"},h.UserCount))),r.a.createElement("ul",{className:"player-list list flex-column p-1 m-2"},d.map((function(e){return r.a.createElement("li",{className:"list-item flex-row align-center p-2 m-1",key:e.Id},r.a.createElement("div",{className:"player-name flex-row fill-left align-center"},r.a.createElement("i",{className:"city-icon color-".concat(e.Color," cursor-pointer"),onClick:function(){return b(e.Id)}}),r.a.createElement("span",{className:"px-2"},e.Name)),r.a.createElement("i",{className:"material-icons cursor-pointer mx-2",onClick:function(){e.Id}},"delete"),r.a.createElement("i",{className:"material-icons cursor-pointer mx-1",onClick:function(){return g(e.Id)}},e.IsDone?"thumb_up":"thumb_down"))}))),r.a.createElement("div",{className:"flex-row align-center"},r.a.createElement("button",{className:"button mx-1",onClick:function(){(function(e){return k("room/leave",{headers:{"Content-type":"application/json",authToken:e},method:"POST"})})(i).then((function(){t.push("/rooms")}))}},"leave"),r.a.createElement("div",{className:"fill-left"}),r.a.createElement("button",{className:"button mx-1",onClick:function(){}},"add bot"),r.a.createElement("button",{className:"button mx-1",onClick:function(){}},"start game")))}function G(){return r.a.createElement("div",{className:"form flex-column p-2"},r.a.createElement("h1",{className:"flex-row m-2"},r.a.createElement("span",{className:"fill-left"},"create room")),r.a.createElement("div",{className:"flex-row align-center"},r.a.createElement(i.b,{to:"/rooms"},r.a.createElement("button",{className:"button mx-1"},"quit")),r.a.createElement("div",{className:"fill-left"}),r.a.createElement("button",{className:"button mx-1"},"create room")))}function F(){var e=Object(u.j)().path;return r.a.createElement(u.d,null,r.a.createElement(u.b,{exact:!0,path:e},r.a.createElement(_,null)),r.a.createElement(u.b,{path:"".concat(e,"/new")},r.a.createElement(G,null)),r.a.createElement(u.b,{path:"".concat(e,"/:_roomId")},r.a.createElement(B,null)))}n(46);function V(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.startsWith("{")?e:e.substring(e.indexOf("{"))}var W=new(function(){function e(){Object(b.a)(this,e),this.ws=null,this.isConnected=!1}return Object(g.a)(e,[{key:"connect",value:function(e){var t,n=this;return N.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return"\ud83c\udf10ws:",t=function(e){switch(e.type){case"message":var t=V(e.data);console.log("\ud83c\udf10ws:",e.type,JSON.parse(t||null));break;default:console.log("\ud83c\udf10ws:",e.type,e)}},a.next=4,N.a.awrap(new Promise((function(e,a){n.ws=new WebSocket("wss://pg-api.azurewebsites.net/api"),n.ws.addEventListener("open",(function(a){n.isConnected=!0,e(a),t(a)})),n.ws.addEventListener("message",t),n.ws.addEventListener("close",t)})));case 4:this.send({AuthToken:e,Type:"AUTHSTATUS"});case 5:case"end":return a.stop()}}),null,this)}},{key:"send",value:function(e){this.ws.send(JSON.stringify(e))}},{key:"disconnect",value:function(){this.ws.close()}}]),e}());Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(47);c.a.render(r.a.createElement((function(){var e=j(),t=Object(l.a)(e,2),n=t[0],o=n.isOnline,c=n.authToken;return Object(s.a)(t[1]),Object(a.useEffect)((function(){o&&W.connect(c)}),[o]),r.a.createElement(i.a,null,r.a.createElement("div",{className:p()("app",{"is-online":o})},r.a.createElement(C,null),r.a.createElement(R,null),r.a.createElement(u.d,null,r.a.createElement(J,{path:"/login"},r.a.createElement(D,null)),r.a.createElement(J,{path:"/register"},r.a.createElement(P,null)),r.a.createElement(x,{path:"/rooms"},r.a.createElement(F,null)),r.a.createElement(u.b,{path:"/"},r.a.createElement(u.a,{to:"/rooms"})))))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[30,1,2]]]);
//# sourceMappingURL=main.414b1c5d.chunk.js.map