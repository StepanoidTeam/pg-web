(this["webpackJsonppg-web"]=this["webpackJsonppg-web"]||[]).push([[0],{33:function(e,t,a){e.exports=a(51)},43:function(e,t,a){},44:function(e){e.exports=JSON.parse('{"name":"pg-web","homepage":"https://stepanoidteam.github.io/pg-web","version":"0.1.6","private":true,"scripts":{"start":"PORT=3001 react-scripts start","deploy":"gh-pages -d build -m deployment","predeploy":"npm version patch -f && npm run build","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject"},"dependencies":{"@testing-library/jest-dom":"^4.2.4","@testing-library/react":"^9.4.0","@testing-library/user-event":"^7.2.1","classnames":"^2.2.6","lodash":"^4.17.15","react":"^16.12.0","react-dom":"^16.12.0","react-router-dom":"^5.1.2","react-scripts":"3.3.0","source-map-explorer":"^2.2.2","use-global-hook":"^0.1.12"},"eslintConfig":{"extends":"react-app","rules":{"no-empty-pattern":"off","react-hooks/exhaustive-deps":"off"}},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"devDependencies":{"gh-pages":"^2.2.0"}}')},45:function(e,t,a){},46:function(e,t,a){},47:function(e,t,a){},49:function(e,t,a){},50:function(e,t,a){},51:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(25),c=a.n(o),s=a(9),l=a(1),i=a(3),u=a(10),m=a(15),p=a.n(m),f=a(16),d=a(21),h=a(13),b=a(26),g=a(11),v=a(12),E=function(){function e(){Object(g.a)(this,e)}return Object(v.a)(e,null,[{key:"set",value:function(t,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=new Date(Date.now()+n*e.msDay);document.cookie="".concat(t,"=").concat(a,";expires=").concat(r.toUTCString(),";path=/")}},{key:"get",value:function(e){var t=document.cookie.split("; ").map((function(e){return e.split("=")})).find((function(t){var a=Object(l.a)(t,2),n=a[0];a[1];return n===e}))||[null,null];return Object(l.a)(t,2)[1]}},{key:"delete",value:function(e){var t=new Date(0);document.cookie="".concat(e,"=;expires=").concat(t.toUTCString(),";path=/")}},{key:"clear",value:function(){document.cookie.split("; ").map((function(e){return e.split("=")})).forEach((function(t){var a=Object(l.a)(t,1)[0];return e.delete(a)}))}}]),e}();E.msDay=864e5;var j={isOnline:!1,apiVersion:null,authToken:E.get("authToken"),isAuthenticated:!1,user:null,counter:0,rooms:[],game:{GameRoomId:null,playerBoards:[]}};function O(e,t){var a=t.Id;return[e.state.game.playerBoards.find((function(e){return e.Id===a})),function(t){e.setState({game:Object(h.a)({},e.state.game,{playerBoards:[].concat(Object(d.a)(e.state.game.playerBoards.filter((function(e){return e.Id!==a}))),[t])})})}]}var y={setOnline:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.setState({isOnline:t})},setApiVersion:function(e,t){e.setState({apiVersion:t})},addToCounter:function(e,t){e.setState({counter:e.state.counter+1})},setUserData:function(e,t){var a=t.AuthToken,n=t.Id,r=t.Name,o=t.GameRoomId;e.setState({authToken:a,user:{id:n,name:r},isAuthenticated:!0,game:Object(h.a)({},e.state.game,{GameRoomId:o})}),E.set("authToken",a)},clearUserData:function(e){e.setState({authToken:null,user:null,isAuthenticated:!1}),E.delete("authToken")},setRooms:function(e,t){e.setState({rooms:t})},setUserJoin:function(e,t){var a=O(e,{Id:t.Id});(0,Object(l.a)(a,2)[1])(Object(h.a)({},t,{EntityType:"PlayerBoard",Color:0,IsDone:!1,Money:0}))},setUserLeave:function(e,t){var a=t.Id;e.setState({game:Object(h.a)({},e.state.game,{playerBoards:Object(d.a)(e.state.game.playerBoards.filter((function(e){return e.Id!==a})))})})},setPlayerBoards:function(e,t){e.setState({game:Object(h.a)({},e.state.game,{playerBoards:t})})},setPlayerColor:function(e,t){var a=t.Id,n=t.Color,r=O(e,{Id:a}),o=Object(l.a)(r,2),c=o[0],s=o[1];if(!c)return console.warn("".concat(a," not found"));c.Color=n,s(c)},setPlayerIsDone:function(e,t){var a=t.Id,n=t.IsDone,r=O(e,{Id:a}),o=Object(l.a)(r,2),c=o[0],s=o[1];if(!c)return console.warn("".concat(a," not found"));c.IsDone=n,s(c)}},w=Object(b.a)(r.a,j,y);function x(e){var t=e.children,a=Object(f.a)(e,["children"]),n=w(),o=Object(l.a)(n,1)[0].isAuthenticated;return r.a.createElement(u.b,Object.assign({},a,{render:function(e){var a=e.location;return o?t:r.a.createElement(u.a,{to:{pathname:"/login",state:{from:a}}})}}))}var N=a(6),k=a.n(N),T="https://pg-api.azurewebsites.net/api";function C(e){var t,a,n,r,o,c=arguments;return k.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:for(s.prev=0,t=c.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=c[n];return s.next=4,k.a.awrap(fetch.apply(void 0,["".concat(T,"/").concat(e)].concat(a)));case 4:if((r=s.sent).ok){s.next=9;break}return s.next=8,k.a.awrap(r.json());case 8:throw s.sent;case 9:return s.next=11,k.a.awrap(r.json());case 11:return o=s.sent,s.abrupt("return",o.data);case 15:return s.prev=15,s.t0=s.catch(0),console.warn("api error",s.t0),s.abrupt("return",Promise.reject(s.t0));case 19:case"end":return s.stop()}}),null,null,[[0,15]])}a(43);var I=a(44).version;function S(){var e=w(),t=Object(l.a)(e,2),a=t[0].apiVersion,o=t[1],c=o.setApiVersion,s=o.setOnline;return Object(n.useEffect)((function(){k.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",C("version").then((function(e){return e.version})));case 1:case"end":return e.stop()}})).then((function(e){c(e),s(!0)}))}),[]),r.a.createElement("div",{className:"version-holder flex-column m-1"},r.a.createElement("span",null,"web: ",I),r.a.createElement("span",null,"api: ",a))}var D=a(31),U=a(29),B=a(32),P=(a(45),function(e){function t(e){var a;return Object(g.a)(this,t),(a=Object(D.a)(this,Object(U.a)(t).call(this,e))).state={isFocused:!1},a}return Object(B.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.label,n=t.value,o=t.helperText,c=t.icon,s=t.errorText,l=t.onChange,i=this.state.isFocused,u=0===n.length,m=!!s;return r.a.createElement("label",{className:p()("input cursor-pointer",{"is-focused":i,"is-empty":u,"has-error":m})},r.a.createElement("div",{className:"input-body flex-row justify-between"},r.a.createElement("div",{className:"flex-column justify-center position-relative w-100 px-2"},r.a.createElement("div",{className:"input-label"},a),r.a.createElement("input",{className:"input-value w-100",type:"text",value:n,onChange:function(e){return l(e.target.value)},onFocus:function(){return e.setState({isFocused:!0})},onBlur:function(){return e.setState({isFocused:!1})}})),c&&!m&&r.a.createElement("i",{className:"input-icon material-icons flex-row align-center mx-2"},c),m&&r.a.createElement("i",{className:"error-icon material-icons flex-row align-center mx-2"},"error")),r.a.createElement("hr",{className:"m-0"}),r.a.createElement("div",{className:"input-footer flex-row ml-2"},o&&!m&&r.a.createElement("span",{className:"helper-text text-ellipsis",title:o},o),m&&r.a.createElement("span",{className:"error-text text-ellipsis",title:s},s)))}}]),t}(r.a.Component));function A(){var e=w(),t=Object(l.a)(e,2);Object(s.a)(t[0]);var a=t[1].setUserData,o=Object(n.useState)("kekster2000"),c=Object(l.a)(o,2),m=c[0],p=c[1],f=Object(n.useState)("qwerty123"),d=Object(l.a)(f,2),h=d[0],b=d[1],g=Object(n.useState)(null),v=Object(l.a)(g,2),E=v[0],j=v[1],O=Object(u.g)(),y=(Object(u.h)().state||{from:{pathname:"/"}}).from;return r.a.createElement("div",{className:"form flex-column"},r.a.createElement(P,{label:"username",value:m,helperText:"username should be strong enough",errorText:E,icon:"face",onChange:function(e){return p(e)}}),r.a.createElement(P,{label:"password",value:h,helperText:"keep password simple",icon:"lock",onChange:function(e){return b(e)}}),r.a.createElement("button",{className:"button flex-row align-center justify-center",onClick:function(){(function(e){var t=e.username,a=e.password;return C("auth/login",{headers:{"Content-type":"application/json"},method:"POST",body:JSON.stringify({username:t,password:a})})})({username:m,password:h}).then((function(e){a(e),console.debug("login ok",e),O.replace(y)})).catch((function(e){console.warn("login failed",e),j(e.message)}))}},r.a.createElement("span",null,"log in"),r.a.createElement("i",{className:"material-icons"},"arrow_forward")),r.a.createElement("span",{className:"p-2 flex-row justify-between"},"Don't have an account?",r.a.createElement(i.b,{to:"/register"},"register")))}function R(){var e=w(),t=Object(l.a)(e,2);Object(s.a)(t[0]);var a=t[1].setUserData,o=Object(n.useState)("jailbot007"),c=Object(l.a)(o,2),m=c[0],p=c[1],f=Object(n.useState)("kek123"),d=Object(l.a)(f,2),h=d[0],b=d[1],g=Object(n.useState)(null),v=Object(l.a)(g,2),E=v[0],j=v[1],O=Object(u.g)(),y=(Object(u.h)().state||{from:{pathname:"/"}}).from;return r.a.createElement("div",{className:"form flex-column"},r.a.createElement(P,{label:"username",value:m,helperText:"username should be strong enough",errorText:E,icon:"face",onChange:function(e){return p(e)}}),r.a.createElement(P,{label:"password",value:h,helperText:"keep password simple",icon:"lock",onChange:function(e){return b(e)}}),r.a.createElement("button",{className:"button flex-row align-center justify-center",onClick:function(){(function(e){var t=e.username,a=e.password;return C("auth/register",{headers:{"Content-type":"application/json"},method:"POST",body:JSON.stringify({username:t,password:a})})})({username:m,password:h}).then((function(e){a(e),console.debug("register ok:",e),O.replace(y)})).catch((function(e){console.warn("register failed:",e.message),j(e.message)}))}},r.a.createElement("span",null,"register"),r.a.createElement("i",{className:"material-icons"},"add_box")),r.a.createElement("span",{className:"p-2 flex-row justify-between"},"Already have an account?",r.a.createElement(i.b,{to:"/login"},"log in")))}a(46);function J(){var e=Object(u.g)(),t=w(),a=Object(l.a)(t,2),o=a[0],c=o.authToken,s=o.isAuthenticated,i=o.user,m=a[1],p=m.setUserData,f=m.clearUserData;return Object(n.useEffect)((function(){c&&!s&&function(e){return C("auth/status",{headers:{"Content-type":"application/json",authToken:e},method:"POST",body:JSON.stringify({gameRoomId:!0,lastActivityTime:!0,isOnline:!0,authToken:!0,id:!0,name:!0})}).then((function(e){return e.data}))}(c).then((function(t){p(t),t.GameRoomId&&e.push("rooms/".concat(encodeURIComponent(t.GameRoomId)))})).catch(f)}),[]),r.a.createElement("div",{className:"status flex-column align-end p-1"},s?r.a.createElement("div",{className:"flex-row align-center"},r.a.createElement("div",{className:"flex-row align-center mx-2"},r.a.createElement("i",{className:"material-icons px-1"},"face"),r.a.createElement("span",null,i.name)),r.a.createElement("button",{className:"button flex-row align-center px-3",onClick:f},r.a.createElement("span",null," log out"),r.a.createElement("i",{className:"material-icons"},"exit_to_app"))):r.a.createElement("div",null,"unauthorized"))}function _(e){var t=e.children,a=Object(f.a)(e,["children"]),n=w(),o=Object(l.a)(n,1)[0].isAuthenticated;return r.a.createElement(u.b,Object.assign({},a,{render:function(){return o?r.a.createElement(u.a,{to:"/"}):t}}))}a(47);function G(){var e=Object(u.g)(),t=w(),a=Object(l.a)(t,2),o=a[0],c=o.authToken,s=o.rooms,i=a[1].setRooms,m=function(t){(function(e,t){return C("room/join",{headers:{"Content-type":"application/json",authToken:e},method:"POST",body:JSON.stringify({roomId:t})})})(c,t).then((function(a){e.push("/rooms/".concat(encodeURIComponent(t)))}))};return Object(n.useEffect)((function(){(function(e){return C("room/list",{headers:{"Content-type":"application/json",authToken:e},method:"GET"})})(c).then((function(e){i(e)}))}),[]),r.a.createElement("div",{className:"rooms form flex-column p-2"},r.a.createElement("h1",{className:"m-2"},"rooms"),r.a.createElement("ul",{className:"room-list list flex-column p-1 m-2"},s.map((function(e){return r.a.createElement("li",{className:"list-item flex-row align-center p-2 m-1",key:e.Id},r.a.createElement("span",{className:"room-name fill-left"},e.Name),r.a.createElement("div",{className:"flex-row align-center"},r.a.createElement("i",{className:"material-icons"},"group"),r.a.createElement("span",{className:"px-1"},e.UserCount),r.a.createElement("button",{className:"button",onClick:function(){return m(e.Id)}},"join")))}))),r.a.createElement("button",{className:"button flex-row align-center justify-center m-2",onClick:function(){e.push("/rooms/new")}},r.a.createElement("span",null,"create new room"),r.a.createElement("i",{className:"material-icons"},"add_box")))}var F=a(30);function L(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return C("game/toggleReady",{headers:{"Content-type":"application/json",authToken:e},method:"POST",body:JSON.stringify({state:t})})}function V(){var e=Object(u.i)()._roomId,t=Object(u.g)(),a=decodeURIComponent(e),o=w(),c=Object(l.a)(o,2),s=c[0],i=s.authToken,m=s.rooms,p=s.game,f=c[1].setPlayerBoards,d=p.playerBoards;Object(n.useEffect)((function(){(function(e){return C("game/status",{headers:{"Content-type":"application/json",authToken:e},method:"GET"})})(i).then((function(e){f(e.PlayerBoards)}))}),[]);var h=m.find((function(e){return e.Id===a}));if(!h)return null;var b=function(e){(function(e,t){return C("game/changeColor",{headers:{"Content-type":"application/json",authToken:e},method:"POST",body:JSON.stringify({userId:t})})})(i,e).then((function(){}))},g=Object(F.sortBy)(d,"Id"),v=g.every((function(e){return e.IsDone}));return r.a.createElement("div",{className:"form flex-column p-2"},r.a.createElement("h1",{className:"flex-row m-2"},r.a.createElement("span",{className:"fill-left"},h.Name),r.a.createElement("div",{className:"flex-row align-center"},r.a.createElement("i",{className:"material-icons"},"group"),r.a.createElement("span",{className:"px-1"},g.length))),r.a.createElement("ul",{className:"player-list list flex-column p-1 m-2"},g.map((function(e){return r.a.createElement("li",{className:"list-item flex-row align-center p-2 m-1",key:e.Id},r.a.createElement("div",{className:"player-name flex-row fill-left align-center"},r.a.createElement("i",{className:"city-icon color-".concat(e.Color," cursor-pointer"),onClick:function(){return b(e.Id)}}),r.a.createElement("span",{className:"px-2"},e.Name)),r.a.createElement("i",{className:"material-icons cursor-pointer mx-2",onClick:function(){e.Id}},"delete"),r.a.createElement("i",{className:"material-icons cursor-pointer mx-1",style:{color:e.IsDone?"gold":"gray"},onClick:function(){return function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];L(i,t).then((function(){}))}(e.Id,!e.IsDone)}},e.IsDone?"thumb_up":"thumb_down"))}))),r.a.createElement("div",{className:"flex-row align-center"},r.a.createElement("button",{className:"button mx-1",onClick:function(){(function(e){return C("room/leave",{headers:{"Content-type":"application/json",authToken:e},method:"POST"})})(i).then((function(){t.push("/rooms")}))}},"leave"),r.a.createElement("div",{className:"fill-left"}),r.a.createElement("button",{className:"button mx-1",onClick:function(){}},"add bot"),r.a.createElement("button",{className:"button mx-1",disabled:!v,onClick:function(){}},"start game")))}function W(){return r.a.createElement("div",{className:"form flex-column p-2"},r.a.createElement("h1",{className:"flex-row m-2"},r.a.createElement("span",{className:"fill-left"},"create room")),r.a.createElement("div",{className:"flex-row align-center"},r.a.createElement(i.b,{to:"/rooms"},r.a.createElement("button",{className:"button mx-1"},"quit")),r.a.createElement("div",{className:"fill-left"}),r.a.createElement("button",{className:"button mx-1"},"create room")))}function z(){var e=Object(u.j)().path;return r.a.createElement(u.d,null,r.a.createElement(u.b,{exact:!0,path:e},r.a.createElement(G,null)),r.a.createElement(u.b,{path:"".concat(e,"/new")},r.a.createElement(W,null)),r.a.createElement(u.b,{path:"".concat(e,"/:_roomId")},r.a.createElement(V,null)))}a(49);function q(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.startsWith("{")?e:e.substring(e.indexOf("{"))}var H=new(function(){function e(){Object(g.a)(this,e),this.ws=null,this.isConnected=!1}return Object(v.a)(e,[{key:"reducer",value:function(e){var t=Object(l.a)(this.globals,2);Object(s.a)(t[0]);var a=t[1],n=a.setPlayerColor,r=a.setPlayerIsDone,o=a.setUserJoin,c=a.setUserLeave;switch(e.BroadcastReason){case"/api/game/changecolor":n(Object(l.a)(e.PlayerBoards,1)[0]);break;case"/api/game/toggleready":r(Object(l.a)(e.PlayerBoards,1)[0]);break;case"/api/room/join":o(Object(l.a)(e.Users,1)[0]);break;case"/api/room/leave":if(!e.Users)return;c(Object(l.a)(e.Users,1)[0]);break;default:console.warn("unhandled reason",e.BroadcastReason,e)}}},{key:"connect",value:function(e){var t,a,n,r,o=this;return k.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return this.globals=e,t=Object(l.a)(e,2),a=t[0].authToken,n=t[1].setOnline,"\ud83c\udf10ws:",r=function(e){switch(e.type){case"message":var t=JSON.parse(q(e.data)||null);console.debug("\ud83c\udf10ws:",e.type,t),o.reducer(t);break;case"close":n(!1),console.debug("\ud83c\udf10ws:",e.type,e.data);break;default:console.debug("\ud83c\udf10ws:",e.type,e)}},c.next=6,k.a.awrap(new Promise((function(e,t){o.ws=new WebSocket("wss://pg-api.azurewebsites.net/api"),o.ws.addEventListener("open",(function(t){o.isConnected=!0,e(t),r(t)})),o.ws.addEventListener("message",r),o.ws.addEventListener("close",r)})));case 6:this.send({AuthToken:a,Type:"AUTHSTATUS"});case 7:case"end":return c.stop()}}),null,this)}},{key:"send",value:function(e){this.ws.send(JSON.stringify(e))}},{key:"disconnect",value:function(){this.ws.close()}}]),e}());Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(50);c.a.render(r.a.createElement((function(){var e=w(),t=Object(l.a)(e,2),a=t[0].isOnline;return Object(s.a)(t[1]),Object(n.useEffect)((function(){a&&H.connect(e)}),[a]),r.a.createElement(i.a,null,r.a.createElement("div",{className:p()("app",{"is-online":a})},r.a.createElement(S,null),r.a.createElement(J,null),r.a.createElement(u.d,null,r.a.createElement(_,{path:"/login"},r.a.createElement(A,null)),r.a.createElement(_,{path:"/register"},r.a.createElement(R,null)),r.a.createElement(x,{path:"/rooms"},r.a.createElement(z,null)),r.a.createElement(u.b,{path:"/"},r.a.createElement(u.a,{to:"/rooms"})))))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[33,1,2]]]);
//# sourceMappingURL=main.62e2cf28.chunk.js.map