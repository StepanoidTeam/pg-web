(this["webpackJsonppg-web"]=this["webpackJsonppg-web"]||[]).push([[0],{38:function(e,t,a){e.exports=a.p+"static/media/wires-20.b1c5e4e0.svg"},39:function(e,t,a){e.exports=a.p+"static/media/connection-from.e75d5b32.svg"},40:function(e,t,a){e.exports=a.p+"static/media/connection-to.93da9075.svg"},41:function(e,t,a){e.exports=a.p+"static/media/path-cost-copper-10.e168a73f.svg"},42:function(e,t,a){e.exports=a.p+"static/media/path-cost-silver-20.ef391d38.svg"},43:function(e,t,a){e.exports=a.p+"static/media/path-cost-goldish-25.eebca72f.svg"},44:function(e,t,a){e.exports=a.p+"static/media/path-cost-gold.f70c738a.svg"},47:function(e,t,a){e.exports=a(74)},64:function(e,t,a){},65:function(e){e.exports=JSON.parse('{"name":"pg-web","homepage":"https://stepanoidteam.github.io/pg-web","version":"0.1.10","private":true,"scripts":{"start":"PORT=3001 react-scripts start","deploy":"gh-pages -d build -m deployment","predeploy":"npm version patch -f && npm run build","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject"},"dependencies":{"@testing-library/jest-dom":"^4.2.4","@testing-library/react":"^9.4.0","@testing-library/user-event":"^7.2.1","classnames":"^2.2.6","firebase":"^7.9.0","lodash":"^4.17.15","react":"^16.12.0","react-dom":"^16.12.0","react-router-dom":"^5.1.2","react-scripts":"3.4.0","source-map-explorer":"^2.2.2","use-global-hook":"^0.1.12"},"eslintConfig":{"extends":"react-app","rules":{"no-empty-pattern":"off","react-hooks/exhaustive-deps":"off"}},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"devDependencies":{"gh-pages":"^2.2.0"}}')},66:function(e,t,a){},67:function(e,t,a){},68:function(e,t,a){},70:function(e,t,a){},71:function(e,t,a){},72:function(e,t,a){},73:function(e,t,a){},74:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(33),c=a.n(o),s=a(12),i=(a(52),a(54),a(56),a(6)),l=a(1),u=a(4),m=a(13),p=a(22),f=a.n(p),d=a(23),h=a(29),v=a(8),b=a(34),g=a(15),y=a(16),E=function(){function e(){Object(g.a)(this,e)}return Object(y.a)(e,null,[{key:"set",value:function(t,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=new Date(Date.now()+n*e.msDay);document.cookie="".concat(t,"=").concat(a,";expires=").concat(r.toUTCString(),";path=/")}},{key:"get",value:function(e){var t=document.cookie.split("; ").map((function(e){return e.split("=")})).find((function(t){var a=Object(l.a)(t,2),n=a[0];a[1];return n===e}))||[null,null];return Object(l.a)(t,2)[1]}},{key:"delete",value:function(e){var t=new Date(0);document.cookie="".concat(e,"=;expires=").concat(t.toUTCString(),";path=/")}},{key:"clear",value:function(){document.cookie.split("; ").map((function(e){return e.split("=")})).forEach((function(t){var a=Object(l.a)(t,1)[0];return e.delete(a)}))}}]),e}();E.msDay=864e5;var x={isOnline:!1,apiVersion:null,authToken:E.get("authToken"),isAuthenticated:!1,user:null,counter:0,rooms:[],game:{GameRoomId:null,playerBoards:[]}};function w(e,t){var a=t.Id;return[e.state.game.playerBoards.find((function(e){return e.Id===a})),function(t){e.setState({game:Object(v.a)({},e.state.game,{playerBoards:[].concat(Object(h.a)(e.state.game.playerBoards.filter((function(e){return e.Id!==a}))),[t])})})}]}var j={setOnline:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.setState({isOnline:t})},setApiVersion:function(e,t){e.setState({apiVersion:t})},addToCounter:function(e,t){e.setState({counter:e.state.counter+1})},setUserData:function(e,t){var a=t.AuthToken,n=t.Id,r=(t.Name,t.GameRoomId),o=(t.displayName,t.email);t.emailVerified,t.photoURL,t.isAnonymous,t.uid,t.providerDat;e.setState({authToken:a,user:{id:n,name:o},isAuthenticated:!0,game:Object(v.a)({},e.state.game,{GameRoomId:r})}),E.set("authToken",a)},clearUserData:function(e){e.setState({authToken:null,user:null,isAuthenticated:!1}),E.delete("authToken")},setRooms:function(e,t){e.setState({rooms:t})},setUserJoin:function(e,t){var a=w(e,{Id:t.Id});(0,Object(l.a)(a,2)[1])(Object(v.a)({},t,{EntityType:"PlayerBoard",Color:0,IsDone:!0,Money:0}))},setUserLeave:function(e,t){var a=t.Id;e.setState({game:Object(v.a)({},e.state.game,{playerBoards:Object(h.a)(e.state.game.playerBoards.filter((function(e){return e.Id!==a})))})})},setPlayerBoards:function(e,t){e.setState({game:Object(v.a)({},e.state.game,{playerBoards:t})})},setPlayerColor:function(e,t){var a=t.Id,n=t.Color,r=w(e,{Id:a}),o=Object(l.a)(r,2),c=o[0],s=o[1];if(!c)return console.warn("".concat(a," not found"));c.Color=n,s(c)},setPlayerIsDone:function(e,t){var a=t.Id,n=t.IsDone,r=w(e,{Id:a}),o=Object(l.a)(r,2),c=o[0],s=o[1];if(!c)return console.warn("".concat(a," not found"));c.IsDone=n,s(c)}},O=Object(b.a)(r.a,x,j);function N(e){var t=e.children,a=Object(d.a)(e,["children"]),n=O(),o=Object(l.a)(n,1)[0].isAuthenticated;return r.a.createElement(m.b,Object.assign({},a,{render:function(e){var a=e.location;return o?t:r.a.createElement(m.a,{to:{pathname:"/login",state:{from:a}}})}}))}var k=a(11),T=a.n(k),C=a(17),I="https://pg-api.azurewebsites.net/api";function S(e){return D.apply(this,arguments)}function D(){return(D=Object(C.a)(T.a.mark((function e(t){var a,n,r,o,c,s=arguments;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(e.prev=0,a=s.length,n=new Array(a>1?a-1:0),r=1;r<a;r++)n[r-1]=s[r];return e.next=4,fetch.apply(void 0,["".concat(I,"/").concat(t)].concat(n));case 4:if((o=e.sent).ok){e.next=9;break}return e.next=8,o.json();case 8:throw e.sent;case 9:return e.next=11,o.json();case 11:return c=e.sent,e.abrupt("return",c.data);case 15:return e.prev=15,e.t0=e.catch(0),console.warn("api error",e.t0),e.abrupt("return",Promise.reject(e.t0));case 19:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)}function B(){return(B=Object(C.a)(T.a.mark((function e(){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",S("version").then((function(e){return e.version})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a(64);var U=a(65).version;function A(){var e=O(),t=Object(l.a)(e,2),a=t[0].apiVersion,o=t[1].setApiVersion;return Object(n.useEffect)((function(){(function(){return B.apply(this,arguments)})().then((function(e){o(e)}))}),[]),r.a.createElement("div",{className:"version-holder flex-column m-1 z-index-1"},r.a.createElement("span",null,"web: ",U),r.a.createElement("span",null,"\ud83d\udd25api: ",a))}var P=a(45),R=a(37),L=a(46),J=(a(66),function(e){function t(e){var a;return Object(g.a)(this,t),(a=Object(P.a)(this,Object(R.a)(t).call(this,e))).state={isFocused:!1},a}return Object(L.a)(t,e),Object(y.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.label,n=t.value,o=t.helperText,c=t.icon,s=t.errorText,i=t.onChange,l=this.state.isFocused,u=0===n.length,m=!!s;return r.a.createElement("label",{className:f()("input cursor-pointer",{"is-focused":l,"is-empty":u,"has-error":m})},r.a.createElement("div",{className:"input-body flex-row justify-between"},r.a.createElement("div",{className:"flex-column justify-center position-relative w-100 px-2"},r.a.createElement("div",{className:"input-label"},a),r.a.createElement("input",{className:"input-value w-100",type:"text",value:n,onChange:function(e){return i(e.target.value)},onFocus:function(){return e.setState({isFocused:!0})},onBlur:function(){return e.setState({isFocused:!1})}})),c&&!m&&r.a.createElement("i",{className:"input-icon material-icons flex-row align-center mx-2"},c),m&&r.a.createElement("i",{className:"error-icon material-icons flex-row align-center mx-2"},"error")),r.a.createElement("hr",{className:"m-0"}),r.a.createElement("div",{className:"input-footer flex-row ml-2"},o&&!m&&r.a.createElement("span",{className:"helper-text text-ellipsis",title:o},o),m&&r.a.createElement("span",{className:"error-text text-ellipsis",title:s},s)))}}]),t}(r.a.Component));function M(){var e=O(),t=Object(l.a)(e,2);Object(i.a)(t[0]);var a=t[1].setUserData,o=Object(n.useState)("kekster2000@example.com"),c=Object(l.a)(o,2),p=c[0],f=c[1],d=Object(n.useState)("qwerty123"),h=Object(l.a)(d,2),v=h[0],b=h[1],g=Object(n.useState)(null),y=Object(l.a)(g,2),E=y[0],x=y[1],w=Object(m.g)(),j=(Object(m.h)().state||{from:{pathname:"/"}}).from;return r.a.createElement("div",{className:"form flex-column"},r.a.createElement(J,{label:"username",value:p,helperText:"username should be strong enough",errorText:E,icon:"face",onChange:function(e){return f(e)}}),r.a.createElement(J,{label:"password",value:v,helperText:"keep password simple",icon:"lock",onChange:function(e){return b(e)}}),r.a.createElement("button",{className:"button flex-row align-center justify-center",onClick:function(){s.auth().signInWithEmailAndPassword(p,v).then((function(e){console.debug("\ud83d\udd25login ok",e),a(e.user),w.replace(j)})).catch((function(e){console.warn("\ud83d\udd25login failed",e),x(e.message)}))}},r.a.createElement("span",null,"log in"),r.a.createElement("i",{className:"material-icons"},"arrow_forward")),r.a.createElement("span",{className:"p-2 flex-row justify-between"},"Don't have an account?",r.a.createElement(u.b,{to:"/register"},"register")))}function _(){var e=O(),t=Object(l.a)(e,2);Object(i.a)(t[0]);var a=t[1].setUserData,o=Object(n.useState)("jailbot007"),c=Object(l.a)(o,2),p=c[0],f=c[1],d=Object(n.useState)("kek123"),h=Object(l.a)(d,2),v=h[0],b=h[1],g=Object(n.useState)(null),y=Object(l.a)(g,2),E=y[0],x=y[1],w=Object(m.g)(),j=(Object(m.h)().state||{from:{pathname:"/"}}).from;return r.a.createElement("div",{className:"form flex-column"},r.a.createElement(J,{label:"username",value:p,helperText:"username should be strong enough",errorText:E,icon:"face",onChange:function(e){return f(e)}}),r.a.createElement(J,{label:"password",value:v,helperText:"keep password simple",icon:"lock",onChange:function(e){return b(e)}}),r.a.createElement("button",{className:"button flex-row align-center justify-center",onClick:function(){s.auth().createUserWithEmailAndPassword(p,v).then((function(e){console.log("\ud83d\udd25auth",e.user),a(e),w.replace(j)})).catch((function(e){console.warn("\ud83d\udd25register failed:",e),x(e.message)}))}},r.a.createElement("span",null,"register"),r.a.createElement("i",{className:"material-icons"},"add_box")),r.a.createElement("span",{className:"p-2 flex-row justify-between"},"Already have an account?",r.a.createElement(u.b,{to:"/login"},"log in")))}a(67);function z(){var e=Object(m.g)(),t=O(),a=Object(l.a)(t,2),o=a[0],c=o.authToken,s=o.isAuthenticated,i=o.user,u=a[1],p=u.setUserData,f=u.clearUserData;return Object(n.useEffect)((function(){c&&!s&&function(e){return S("auth/status",{headers:{"Content-type":"application/json",authToken:e},method:"POST",body:JSON.stringify({gameRoomId:!0,lastActivityTime:!0,isOnline:!0,authToken:!0,id:!0,name:!0})}).then((function(e){return e.data}))}(c).then((function(t){p(t),t.GameRoomId&&e.push("rooms/".concat(encodeURIComponent(t.GameRoomId)))})).catch(f)}),[]),r.a.createElement("div",{className:"status-holder flex-column align-end p-1 z-index-1"},s?r.a.createElement("div",{className:"flex-row align-center"},r.a.createElement("div",{className:"flex-row align-center mx-2"},r.a.createElement("i",{className:"material-icons px-1"},"face"),r.a.createElement("span",null,i.name)),r.a.createElement("button",{className:"button flex-row align-center px-3",onClick:f},r.a.createElement("span",null," log out"),r.a.createElement("i",{className:"material-icons"},"exit_to_app"))):r.a.createElement("div",null,"unauthorized"))}function W(e){var t=e.children,a=Object(d.a)(e,["children"]),n=O(),o=Object(l.a)(n,1)[0].isAuthenticated;return r.a.createElement(m.b,Object.assign({},a,{render:function(){return o?r.a.createElement(m.a,{to:"/"}):t}}))}a(68);function Y(){var e=Object(m.g)(),t=O(),a=Object(l.a)(t,2),o=a[0],c=o.authToken,i=o.rooms,u=a[1].setRooms,p=function(t){(function(e,t){return S("room/join",{headers:{"Content-type":"application/json",authToken:e},method:"POST",body:JSON.stringify({roomId:t})})})(c,t).then((function(a){e.push("/rooms/".concat(encodeURIComponent(t)))}))};return Object(n.useEffect)((function(){s.database().ref("/rooms").on("value",(function(e){console.log("\ud83d\udd25",e.val());var t=Object.values(e.val());u(t)}))}),[]),r.a.createElement("div",{className:"rooms form flex-column p-2"},r.a.createElement("h1",{className:"mx-2"},"rooms"),r.a.createElement("ul",{className:"room-list list flex-column p-1 m-2"},i.map((function(e){return r.a.createElement("li",{className:"list-item flex-row align-center p-2 m-1",key:e.Id},r.a.createElement("span",{className:"room-name fill-left"},e.Name),r.a.createElement("div",{className:"flex-row align-center"},r.a.createElement("i",{className:"material-icons"},"group"),r.a.createElement("span",{className:"px-1"},e.UserCount),r.a.createElement("button",{className:"button",onClick:function(){return p(e.Id)}},"join")))}))),r.a.createElement("button",{className:"button flex-row align-center justify-center m-2",onClick:function(){e.push("/rooms/new")}},r.a.createElement("span",null,"create new room"),r.a.createElement("i",{className:"material-icons"},"add_box")))}var F=a(14);function G(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return S("game/toggleReady",{headers:{"Content-type":"application/json",authToken:e},method:"POST",body:JSON.stringify({state:t})})}function H(){var e=Object(m.i)()._roomId,t=Object(m.g)(),a=decodeURIComponent(e),o=O(),c=Object(l.a)(o,2),s=c[0],i=s.authToken,u=s.rooms,p=s.game,f=c[1].setPlayerBoards,d=p.playerBoards;Object(n.useEffect)((function(){(function(e){return S("game/status",{headers:{"Content-type":"application/json",authToken:e},method:"GET"})})(i).then((function(e){f(e.PlayerBoards)}))}),[]);var h=u.find((function(e){return e.Id===a}));if(!h)return null;var v=function(e){(function(e,t){return S("game/changeColor",{headers:{"Content-type":"application/json",authToken:e},method:"POST",body:JSON.stringify({userId:t})})})(i,e).then((function(){}))},b=function(e){(function(e,t){return S("room/kick?username=".concat(t),{headers:{"Content-type":"application/json",authToken:e},method:"POST",body:JSON.stringify({username:t})})})(i,e).then((function(){}))},g=Object(F.sortBy)(d,"Id"),y=g.every((function(e){return e.IsDone}));return r.a.createElement("div",{className:"form flex-column p-2"},r.a.createElement("h1",{className:"flex-row mx-2"},r.a.createElement("span",{className:"fill-left"},h.Name),r.a.createElement("div",{className:"flex-row align-center"},r.a.createElement("i",{className:"material-icons"},"group"),r.a.createElement("span",{className:"px-1"},g.length))),r.a.createElement("ul",{className:"player-list list flex-column p-1 m-2"},g.map((function(e){return r.a.createElement("li",{className:"list-item flex-row align-center p-2 m-1",key:e.Id},r.a.createElement("div",{className:"player-name flex-row fill-left align-center"},r.a.createElement("i",{className:"city-icon color-".concat(e.Color," cursor-pointer"),onClick:function(){return v(e.Id)}}),r.a.createElement("span",{className:"px-2"},e.Name)),r.a.createElement("i",{className:"material-icons cursor-pointer mx-2",onClick:function(){return b(e.Name)}},"delete"),r.a.createElement("i",{className:"material-icons cursor-pointer mx-1",style:{color:e.IsDone?"gold":"gray"},onClick:function(){return function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];G(i,t).then((function(){}))}(e.Id,!e.IsDone)}},e.IsDone?"thumb_up":"thumb_down"))}))),r.a.createElement("div",{className:"flex-row align-center"},r.a.createElement("button",{className:"button mx-1",onClick:function(){(function(e){return S("room/leave",{headers:{"Content-type":"application/json",authToken:e},method:"POST"})})(i).then((function(){t.push("/rooms")}))}},"leave"),r.a.createElement("div",{className:"fill-left"}),r.a.createElement("button",{className:"button mx-1",onClick:function(){}},"add bot"),r.a.createElement("button",{className:"button mx-1",disabled:!y,onClick:function(){}},"start game")))}function V(){var e=Object(n.useState)([]),t=Object(l.a)(e,2),a=t[0],o=t[1],c=Object(m.g)(),s=O(),p=Object(l.a)(s,2),f=p[0].authToken;Object(i.a)(p[1]),Object(n.useEffect)((function(){(function(e){return S("maps/list",{headers:{"Content-type":"application/json",authToken:e},method:"GET"})})().then((function(e){o(e)}))}),[]);return r.a.createElement("div",{className:"form flex-column p-2"},r.a.createElement("h1",{className:"flex-row mx-2"},r.a.createElement("span",{className:"fill-left"},"select map")),r.a.createElement("ul",{className:"map-list list flex-column p-1 m-2",style:{width:320}},a.map((function(e){return r.a.createElement("li",{className:"list-item flex-row align-center p-2 m-1",key:e},r.a.createElement("span",{className:"fill-left"},e),r.a.createElement("button",{className:"button",onClick:function(){return t=e,void c.push("/maps/".concat(t));var t}},"preview"))}))),r.a.createElement("div",{className:"flex-row align-center"},r.a.createElement(u.b,{to:"/rooms"},r.a.createElement("button",{className:"button mx-1"},"quit")),r.a.createElement("div",{className:"fill-left"}),r.a.createElement("button",{className:"button mx-1",onClick:function(){(function(e,t){return S("room/create",{headers:{"Content-type":"application/json",authToken:e},method:"POST",body:JSON.stringify({})})})(f).then((function(){}))}},"create room")))}function X(){var e=Object(m.j)().path;return r.a.createElement(m.d,null,r.a.createElement(m.b,{exact:!0,path:e},r.a.createElement(Y,null)),r.a.createElement(m.b,{path:"".concat(e,"/new")},r.a.createElement(V,null)),r.a.createElement(m.b,{path:"".concat(e,"/:_roomId")},r.a.createElement(H,null)))}a(70);function q(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.startsWith("{")?e:e.substring(e.indexOf("{"))}var K=new(function(){function e(){Object(g.a)(this,e),this.ws=null}return Object(y.a)(e,[{key:"reducer",value:function(e){var t=Object(l.a)(this.globals,2);Object(i.a)(t[0]);var a=t[1],n=a.setPlayerColor,r=a.setPlayerIsDone,o=a.setUserJoin,c=a.setUserLeave;switch(e.BroadcastReason){case"/api/game/changecolor":n(Object(l.a)(e.PlayerBoards,1)[0]);break;case"/api/game/toggleready":r(Object(l.a)(e.PlayerBoards,1)[0]);break;case"/api/room/join":if(!e.Users)return;o(Object(l.a)(e.Users,1)[0]);break;case"/api/room/kick":case"/api/room/leave":if(!e.Users)return;c(Object(l.a)(e.Users,1)[0]);break;default:console.warn("unhandled reason",e.BroadcastReason,e)}}},{key:"connect",value:function(){var e=Object(C.a)(T.a.mark((function e(t){var a,n,r,o,c=this;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.globals=t,a=Object(l.a)(t,2),n=a[0].authToken,r=a[1].setOnline,"\ud83c\udf10ws:",o=function e(t){var a=JSON.parse(q(t.data)||null);switch(console.debug("\ud83c\udf10ws:",t.type,a),t.type){case"message":c.reducer(a);break;case"open":c.ws.addEventListener("close",e),c.ws.addEventListener("message",e),r(!0),c.send({AuthToken:n,Type:"AUTHSTATUS"});break;case"close":c.ws.removeEventListener("open",e),c.ws.removeEventListener("message",e),r(!1)}},this.ws=new WebSocket("wss://pg-api.azurewebsites.net/api"),this.ws.addEventListener("open",o);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"send",value:function(e){this.ws.send(JSON.stringify(e))}},{key:"disconnect",value:function(){this.ws.close()}}]),e}());a(71);function $(e){var t=e.cost;return r.a.createElement("div",{className:"city-slot m-1 text-stroke"},t)}function Q(e){var t=e.x,a=e.y,n=e.name,o=e.region;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"overlay flex-row justify-center align-center",style:{left:t,top:a}},r.a.createElement("div",{className:"city-card"},r.a.createElement("div",{className:"city-rows flex-column p-1"},r.a.createElement("div",{className:"city-slots flex-row"},[10,15,20].map((function(e){return r.a.createElement($,{key:e,cost:e})}))),r.a.createElement("div",{className:"position-relative"},r.a.createElement("div",{className:"overlay w-100 h-100 flex-row align-center justify-center"},r.a.createElement("div",{className:"city-name region-".concat(o," px-1 text-stroke")},n))),r.a.createElement("div",{className:"city-slots flex-row",hidden:!0},[10,15,20].map((function(e){return r.a.createElement($,{key:e,cost:e})})))))))}var Z=a(38),ee=a.n(Z),te=a(39),ae=a.n(te),ne=a(40),re=a.n(ne);function oe(e,t){return Math.pow(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2),.5)}for(var ce=[],se=190/3,ie=150/1,le=0;le<3;le++)for(var ue=0;ue<1;ue++)ce.push({x:se*(le-1),y:ie*(ue-0)});var me=a(41),pe=a.n(me),fe=a(42),de=a.n(fe),he=a(43),ve=a.n(he),be=a(44),ge=a.n(be);function ye(e){var t=e.from,a=e.to,n=e.cost,o=function(e,t){var a=ce.map((function(t){return{x:e.x+t.x,y:e.y+t.y}})),n=ce.map((function(e){return{x:t.x+e.x,y:t.y+e.y}})),r=[];a.forEach((function(e){n.forEach((function(t){r.push([e,t,oe(e,t)])}))}));var o=Object(F.minBy)(r,(function(e){return Object(l.a)(e,3)[2]})),c=Object(l.a)(o,3);return[c[0],c[1],c[2]]}(t,a),c=Object(l.a)(o,3),s=c[0],i=c[1],u=c[2],m=function(e,t){return{x:e.x+(t.x-e.x)/2,y:e.y+(t.y-e.y)/2}}(s,i),p=180*Math.atan2(i.y-s.y,i.x-s.x)/Math.PI,f=0,d=-10,h=-60,v=-16,b=40,g=30,y=function(e){return e<10?pe.a:e<20?de.a:e<25?ve.a:ge.a}(n);return r.a.createElement("g",{className:"filter-shadow-connection"},r.a.createElement("rect",{height:"20",width:u,x:s.x,y:s.y,viewBox:"0 0 100 100",viewTarget:"0 0 100 100",transform:"translate(".concat(f," ").concat(d,") rotate(").concat(p," ").concat(s.x-f," ").concat(s.y-d,")"),style:{fill:"url(#wires-pattern)"}}),r.a.createElement("image",{x:s.x,y:s.y,width:b,height:g,xlinkHref:ae.a,transform:"translate(".concat(-h/2.5," ").concat(v,") rotate(").concat(p," ").concat(s.x+h/2.5," ").concat(s.y-v,")")}),r.a.createElement("image",{x:i.x,y:i.y,width:b,height:g,xlinkHref:re.a,transform:"translate(".concat(h," ").concat(v,") rotate(").concat(p," ").concat(i.x-h," ").concat(i.y-v,")")}),r.a.createElement("image",{x:m.x-22.5,y:m.y-22.5,width:45,height:45,xlinkHref:y}),r.a.createElement("foreignObject",{x:m.x-22.5,y:m.y-22.5,width:45,height:45,className:"filter-shadow-text"},r.a.createElement("div",{className:"flex-row align-center justify-center h-100"},r.a.createElement("span",{className:"connection-cost text-stroke"},n))),r.a.createElement("circle",{cx:s.x,cy:s.y,r:"15",style:{fill:"greenyellow",opacity:.7}}),r.a.createElement("circle",{cx:i.x,cy:i.y,r:"15",style:{fill:"red",opacity:.7}}))}a(72);var Ee=2,xe=3;function we(e){var t=e.CoordX,a=e.CoordY;return Object(v.a)({},e,{x:t*Ee,y:a*xe})}function je(){var e=Object(m.i)().mapId,t=O(),a=Object(l.a)(t,2),o=a[0].authToken;Object(i.a)(a[1]);var c=Object(n.useState)(null),s=Object(l.a)(c,2),u=s[0],p=s[1];if(Object(n.useEffect)((function(){(function(e,t){return S("maps/map",{headers:{"Content-type":"application/json",authToken:e},method:"POST",body:JSON.stringify({mapId:t})})})(o,e).then((function(e){console.log("\ud83d\uddfe",e),window.mapData=e,p(e),function(){var e,t,a=null,n=1,r=0,o=0,c=document.querySelector(".map-overlay"),s=document.querySelector(".map-content"),i=function(){window.requestAnimationFrame((function(){var e=c.offsetWidth,t=c.offsetHeight,a=s.getBoundingClientRect(),i=a.width,l=a.height;r=Object(F.clamp)(r,Math.min(0,e-i),Math.max(0,e-i)),o=Object(F.clamp)(o,Math.min(0,t-l),Math.max(0,t-l));var u="translate3D(".concat(r,"px, ").concat(o,"px, 0px) scale(").concat(n,")");s.style.transform=u}))},u=!1;function m(c){if(c.preventDefault(),u=!0,document.body.classList.add("cursor-move"),c instanceof TouchEvent){var s=Object(l.a)(c.touches,1)[0];e=s.pageX-r,t=s.pageY-o}else e=c.pageX-r,t=c.pageY-o;a=n}function p(c){if(c.preventDefault(),u){if(c instanceof TouchEvent){var s=Object(l.a)(c.touches,1)[0];console.log(c.touches),n=a*(s.scale||1),r=s.pageX-e,o=s.pageY-t}else n=a*(c.scale||1),r=c.pageX-e,o=c.pageY-t;i()}}function f(e){e.preventDefault(),u=!1,document.body.classList.remove("cursor-move")}window.addEventListener("wheel",(function(e){e.preventDefault(),e.ctrlKey?(n-=.01*e.deltaY,n=Math.max(.2,n),n=Math.min(1.5,n)):(r-=2*e.deltaX,o-=2*e.deltaY),i()}),{passive:!1}),window.addEventListener("gesturestart",m,{passive:!1}),window.addEventListener("gesturechange",p,{passive:!1}),window.addEventListener("gestureend",f,{passive:!1}),window.addEventListener("mousedown",m,{passive:!1}),window.addEventListener("mousemove",p,{passive:!1}),window.addEventListener("mouseup",f,{passive:!1}),console.log("zoom init done")}()}))}),[]),!u)return r.a.createElement("div",null,"map preview here");var f={width:1650*Ee,height:950*xe};return r.a.createElement("div",null,r.a.createElement("h1",null,"map"),"cities",r.a.createElement("div",{className:"map-overlay"},r.a.createElement("div",{className:"map-content",style:f},r.a.createElement("svg",{className:"map-svg w-100 h-100",version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},r.a.createElement("defs",null,r.a.createElement("pattern",{id:"wires-pattern",height:"100%",width:"100%",viewBox:"0 0 20 20",patternContentUnits:"objectBoundingBox",preserveAspectRatio:"none"},r.a.createElement("image",{width:"20",height:"20",preserveAspectRatio:"xMidYMid slice",xlinkHref:ee.a})),r.a.createElement("filter",{id:"filter-shadow-connection"},r.a.createElement("feDropShadow",{stdDeviation:"0 0",dx:"2",dy:"2",floodColor:"#00000040"})),r.a.createElement("filter",{id:"filter-shadow-text"},r.a.createElement("feDropShadow",{stdDeviation:"0 0",dx:"1",dy:"1",floodColor:"#000000cc"}))),u.Connectors.map((function(e){var t=u.Cities.find((function(t){return t.Id===e.City1Key})),a=u.Cities.find((function(t){return t.Id===e.City2Key}));return r.a.createElement(ye,{key:e.Id,from:we(t),to:we(a),cost:e.Cost})}))),u.Cities.map((function(e){return r.a.createElement(Q,{key:e.Name,x:we(e).x,y:we(e).y,name:e.Name,region:e.RegionKey})})))))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(73);s.initializeApp({apiKey:"AIzaSyBrLjfuTRzphTHh_9V7Aik-jTLylWfAnt0",authDomain:"power-grid-c1320.firebaseapp.com",databaseURL:"https://power-grid-c1320.firebaseio.com",projectId:"power-grid-c1320",storageBucket:"power-grid-c1320.appspot.com",messagingSenderId:"458551111011",appId:"1:458551111011:web:58bbe6f37b886a81c73756"}),c.a.render(r.a.createElement((function(){var e=O(),t=Object(l.a)(e,2),a=t[0].isOnline;return Object(i.a)(t[1]),Object(n.useEffect)((function(){a||K.connect(e)}),[a]),r.a.createElement(u.a,null,r.a.createElement("div",{className:f()("app",{"is-online":a})},r.a.createElement(A,null),r.a.createElement(z,null),r.a.createElement(m.d,null,r.a.createElement(W,{path:"/login"},r.a.createElement(M,null)),r.a.createElement(W,{path:"/register"},r.a.createElement(_,null)),r.a.createElement(N,{path:"/rooms"},r.a.createElement(X,null)),r.a.createElement(m.b,{path:"/maps/:mapId"},r.a.createElement(je,null)),r.a.createElement(m.b,{path:"/"},r.a.createElement(m.a,{to:"/rooms"})))))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[47,1,2]]]);
//# sourceMappingURL=main.c2397f10.chunk.js.map